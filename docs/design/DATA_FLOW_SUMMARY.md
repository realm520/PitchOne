# ğŸ”„ è‡ªåŠ¨åŒ–æ•°æ®æµæ€»ç»“

## âœ… å®Œå…¨è‡ªåŠ¨åŒ–å®ç°

ç°åœ¨**æ¯ä¸€æ­¥éƒ½èƒ½è‡ªåŠ¨ä½¿ç”¨ä¸Šä¸€æ­¥äº§ç”Ÿçš„æ•°æ®**ï¼Œæ— éœ€æ‰‹åŠ¨å¤åˆ¶ç²˜è´´åˆçº¦åœ°å€ï¼

## ğŸ“Š æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 1: Deploy.s.sol                                        â”‚
â”‚  éƒ¨ç½²æ‰€æœ‰åˆçº¦                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è‡ªåŠ¨ç”Ÿæˆ â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  deployments/localhost.json                                 â”‚
â”‚  {                                                           â”‚
â”‚    "contracts": {                                           â”‚
â”‚      "factory": "0x5f3f...",                                â”‚
â”‚      "usdc": "0x5eb3...",                                   â”‚
â”‚      "vault": "0x36C0...",                                  â”‚
â”‚      ...                                                    â”‚
â”‚    },                                                       â”‚
â”‚    "templates": { "wdl": "0xd384...", ... }                 â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚            â”‚
         â”‚ è‡ªåŠ¨è¯»å–   â”‚ è‡ªåŠ¨è¯»å–   â”‚ è‡ªåŠ¨è¯»å–
         â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 2:     â”‚ â”‚ æ­¥éª¤ 3:   â”‚ â”‚ æ­¥éª¤ 4:              â”‚
â”‚ CreateMarkeâ”‚ â”‚ SimulateBâ”‚ â”‚ update-subgraph-    â”‚
â”‚ ts.s.sol   â”‚ â”‚ ets.s.solâ”‚ â”‚ config.sh           â”‚
â”‚            â”‚ â”‚          â”‚ â”‚                     â”‚
â”‚ è¯»å–åœ°å€:   â”‚ â”‚ è¯»å–åœ°å€: â”‚ â”‚ æå–åœ°å€å¹¶æ›¿æ¢æ¨¡æ¿   â”‚
â”‚ - Factory  â”‚ â”‚ - Factoryâ”‚ â”‚                     â”‚
â”‚ - Vault    â”‚ â”‚ - USDC   â”‚ â”‚ Factory â†’           â”‚
â”‚ - USDC     â”‚ â”‚          â”‚ â”‚ subgraph.yaml       â”‚
â”‚ - Template â”‚ â”‚          â”‚ â”‚                     â”‚
â”‚   IDs      â”‚ â”‚          â”‚ â”‚ FeeRouter â†’         â”‚
â”‚            â”‚ â”‚          â”‚ â”‚ subgraph.yaml       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                         è‡ªåŠ¨ç”Ÿæˆ â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  subgraph.yaml                    â”‚
                â”‚  dataSources:                     â”‚
                â”‚    - address: "0x5f3f..." âœ…      â”‚
                â”‚    - address: "0x1291..." âœ…      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å…³é”®æ”¹è¿›

### âœ… ä¹‹å‰ï¼ˆæ‰‹åŠ¨æ“ä½œï¼‰

```bash
# âŒ éœ€è¦æ‰‹åŠ¨å¤åˆ¶åœ°å€
Deploy.s.sol â†’ è¾“å‡ºåœ°å€ 0x5f3f...
             â†’ æ‰‹åŠ¨å¤åˆ¶åˆ° CreateMarkets.s.sol
             â†’ æ‰‹åŠ¨å¤åˆ¶åˆ° subgraph.yaml
             â†’ å®¹æ˜“å‡ºé”™ï¼
```

### âœ… ç°åœ¨ï¼ˆå®Œå…¨è‡ªåŠ¨ï¼‰

```bash
# âœ… å®Œå…¨è‡ªåŠ¨åŒ–
Deploy.s.sol â†’ localhost.json
             â†’ CreateMarkets.s.solï¼ˆè‡ªåŠ¨è¯»å–ï¼‰
             â†’ SimulateBets.s.solï¼ˆè‡ªåŠ¨è¯»å–ï¼‰
             â†’ subgraph.yamlï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
             â†’ é›¶äººä¸ºé”™è¯¯ï¼
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. å¯åŠ¨ Anvilï¼ˆç»ˆç«¯ 1ï¼‰
cd contracts && anvil --host 0.0.0.0

# 2. ä¸€é”®éƒ¨ç½²ï¼ˆç»ˆç«¯ 2ï¼‰
./scripts/quick-deploy.sh
```

**è‡ªåŠ¨æ‰§è¡Œçš„æ­¥éª¤**:
1. âœ… éƒ¨ç½²åˆçº¦ â†’ ç”Ÿæˆ `localhost.json`
2. âœ… åˆ›å»ºå¸‚åœºï¼ˆè‡ªåŠ¨ä» JSON è¯»å–ï¼‰
3. âœ… æ¨¡æ‹ŸæŠ•æ³¨ï¼ˆè‡ªåŠ¨ä» JSON è¯»å–ï¼‰
4. âœ… æ›´æ–° Subgraph é…ç½®ï¼ˆè‡ªåŠ¨ä» JSON è¯»å–ï¼‰
5. âœ… éƒ¨ç½² Subgraphï¼ˆä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ yamlï¼‰

### æ‰‹åŠ¨æ­¥éª¤ï¼ˆäº†è§£ç»†èŠ‚ï¼‰

```bash
# æ­¥éª¤ 1: éƒ¨ç½²åˆçº¦
cd contracts
PRIVATE_KEY=0xac... forge script script/Deploy.s.sol:Deploy \
  --rpc-url http://localhost:8545 --broadcast
# â†’ è‡ªåŠ¨ç”Ÿæˆ deployments/localhost.json âœ…

# æ­¥éª¤ 2: åˆ›å»ºå¸‚åœºï¼ˆè‡ªåŠ¨è¯»å–åœ°å€ï¼‰
PRIVATE_KEY=0xac... forge script script/CreateMarkets_NoMultiLine.s.sol \
  --rpc-url http://localhost:8545 --broadcast
# â†’ ä» localhost.json è¯»å– Factoryã€Vaultã€USDC åœ°å€ âœ…

# æ­¥éª¤ 3: æ¨¡æ‹ŸæŠ•æ³¨ï¼ˆè‡ªåŠ¨è¯»å–åœ°å€ï¼‰
forge script script/SimulateBets.s.sol --broadcast
# â†’ ä» localhost.json è¯»å– Factoryã€USDC åœ°å€ âœ…

# æ­¥éª¤ 4: æ›´æ–° Subgraph é…ç½®
cd ../subgraph
node config/update-config.js ../contracts/deployments/localhost.json
# â†’ ä» localhost.json æå–åœ°å€ï¼Œç”Ÿæˆ subgraph.yaml âœ…

# æ­¥éª¤ 5: éƒ¨ç½² Subgraph
./deploy.sh -c -u -y
```

## ğŸ” éªŒè¯è‡ªåŠ¨åŒ–

### 1. éªŒè¯åˆçº¦åœ°å€è‡ªåŠ¨ç”Ÿæˆ

```bash
cat contracts/deployments/localhost.json | jq '.contracts'

# è¾“å‡º:
# {
#   "factory": "0x5f3f1dBD7B74C6B46e8c44f98792A1dAf8d69154",
#   "usdc": "0x5eb3Bc0a489C5A8288765d2336659EbCA68FCd00",
#   ...
# }
```

### 2. éªŒè¯è„šæœ¬è‡ªåŠ¨è¯»å–åœ°å€

```bash
forge script script/CreateMarkets_NoMultiLine.s.sol -vv | grep "Using addresses"

# è¾“å‡º:
# Using addresses from: deployments/localhost.json
#   Factory: 0x5f3f1dBD7B74C6B46e8c44f98792A1dAf8d69154
#   Vault: 0x36C02dA8a0983159322a80FFE9F24b1acfF8B570
```

### 3. éªŒè¯ Subgraph é…ç½®è‡ªåŠ¨æ›´æ–°

```bash
cd subgraph
node config/update-config.js ../contracts/deployments/localhost.json

# è¾“å‡º:
# ğŸ“ Updating Subgraph configuration...
#   Factory:   0x5f3f1dBD7B74C6B46e8c44f98792A1dAf8d69154
#   FeeRouter: 0x1291Be112d480055DaFd8a610b7d1e203891C274
# âœ… Subgraph é…ç½®å·²æ›´æ–°: subgraph.yaml
# âœ… éªŒè¯æˆåŠŸ: åœ°å€å·²æ­£ç¡®æ›´æ–°
```

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### æ–°å¢æ–‡ä»¶

- âœ… `subgraph/config/update-config.js` - è‡ªåŠ¨æ›´æ–° Subgraph é…ç½®è„šæœ¬
- âœ… `AUTOMATED_DATA_FLOW.md` - å®Œæ•´çš„è‡ªåŠ¨åŒ–æ•°æ®æµæ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- âœ… `DATA_FLOW_SUMMARY.md` - ç®€æ´æ€»ç»“ï¼ˆæœ¬æ–‡ä»¶ï¼‰

### ä¿®æ”¹çš„æ–‡ä»¶

- âœ… `contracts/script/CreateMarkets_NoMultiLine.s.sol` - ä½¿ç”¨ `vm.readFile()` è¯»å–é…ç½®
- âœ… `scripts/quick-deploy.sh` - å¢åŠ æ­¥éª¤ 4ï¼ˆè‡ªåŠ¨æ›´æ–°é…ç½®ï¼‰

### å·²æœ‰æ–‡ä»¶ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

- âœ… `contracts/script/Deploy.s.sol` - å·²è‡ªåŠ¨ç”Ÿæˆ localhost.json
- âœ… `contracts/script/SimulateBets.s.sol` - å·²è‡ªåŠ¨è¯»å– localhost.json
- âœ… `subgraph/subgraph.template.yaml` - å·²åŒ…å«å ä½ç¬¦

## ğŸ‰ æ€»ç»“

| æ­¥éª¤ | æ•°æ®æº | æ•°æ®æµå‘ | çŠ¶æ€ |
|------|--------|----------|------|
| 1. Deploy | æ—  | â†’ `localhost.json` | âœ… è‡ªåŠ¨ç”Ÿæˆ |
| 2. CreateMarkets | `localhost.json` | â†’ è¯»å–åœ°å€ | âœ… è‡ªåŠ¨è¯»å– |
| 3. SimulateBets | `localhost.json` | â†’ è¯»å–åœ°å€ | âœ… è‡ªåŠ¨è¯»å– |
| 4. update-config | `localhost.json` | â†’ `subgraph.yaml` | âœ… è‡ªåŠ¨ç”Ÿæˆ |
| 5. Graph Node | `subgraph.yaml` | â†’ ç´¢å¼•æ•°æ® | âœ… è‡ªåŠ¨åŒæ­¥ |

**ç»“è®º**: ç°åœ¨**æ¯ä¸€æ­¥éƒ½èƒ½è‡ªåŠ¨ä½¿ç”¨ä¸Šä¸€æ­¥çš„æ•°æ®**ï¼Œå®ç°äº†å®Œå…¨çš„è‡ªåŠ¨åŒ–æ•°æ®æµï¼ğŸŠ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´è‡ªåŠ¨åŒ–æ–‡æ¡£](./AUTOMATED_DATA_FLOW.md) - è¯¦ç»†å®ç°è¯´æ˜
- [SOP éƒ¨ç½²æ–‡æ¡£](./subgraph/SOP_LOCAL_DEPLOYMENT.md) - æ ‡å‡†æ“ä½œæµç¨‹
- [æµç¨‹å›¾æ–‡æ¡£](./subgraph/DEPLOYMENT_FLOW.md) - å¯è§†åŒ–æµç¨‹

---

**æœ€åæ›´æ–°**: 2025-11-14
**çŠ¶æ€**: âœ… å®Œå…¨è‡ªåŠ¨åŒ–å®ç°
