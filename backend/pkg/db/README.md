# PitchOne Database Migrations - M2/M3

## ğŸ“Š æ•°æ®åº“åˆå§‹åŒ–éªŒè¯æŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**: 2025-11-08
**æ•°æ®åº“ç‰ˆæœ¬**: PostgreSQL 14
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡

---

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### è¿ç§»è„šæœ¬çŠ¶æ€

| è¿ç§»ç‰ˆæœ¬ | æè¿° | è¡¨æ•°é‡ | çŠ¶æ€ |
|---------|------|--------|------|
| 001 | åˆå§‹ Schemaï¼ˆMarkets, Orders, Positionsï¼‰ | 5 | âœ… é€šè¿‡ |
| 002 | Keeper å­—æ®µæ‰©å±• | 1 | âœ… é€šè¿‡ |
| 003 | Rewards åˆ†å‘è¡¨ | 3 | âœ… é€šè¿‡ |
| 004 | Market å‚æ•°æ‰©å±• | 1 | âœ… é€šè¿‡ |
| 005 | **Campaign & Quest è¡¨** | 7 | âœ… é€šè¿‡ |
| 006 | **Basket & PlayerProps è¡¨** | 7 | âœ… é€šè¿‡ |

**æ€»è®¡**: 6 ä¸ªè¿ç§»è„šæœ¬ï¼Œåˆ›å»º 24 ä¸ªè¡¨ï¼Œå…¨éƒ¨æˆåŠŸåº”ç”¨ã€‚

---

## ğŸ§ª æµ‹è¯•ç»“æœæ€»ç»“

### 1. CRUD æ“ä½œæµ‹è¯• âœ…

æ‰€æœ‰åŸºç¡€å¢åˆ æ”¹æŸ¥æ“ä½œæ­£å¸¸ï¼š
- âœ… Campaign åˆ›å»ºå’ŒæŸ¥è¯¢
- âœ… Quest è¿›åº¦è¿½è¸ªå’Œå®Œæˆè®°å½•
- âœ… Referral å…³ç³»ç»‘å®šå’Œç»Ÿè®¡
- âœ… Parlay ä¸²å…³å’Œè…¿è¯¦æƒ…
- âœ… PlayerProps å¸‚åœºå’Œä¸‹æ³¨

### 2. çº¦æŸæµ‹è¯• âœ…

æ‰€æœ‰æ•°æ®å®Œæ•´æ€§çº¦æŸæ­£å¸¸å·¥ä½œï¼š
- âœ… UNIQUE: é˜²æ­¢é‡å¤ refereeã€tx_hash+log_index
- âœ… CHECK: budget > 0, leg_count 2-8, æ—¶é—´èŒƒå›´éªŒè¯
- âœ… FK CASCADE: çº§è”åˆ é™¤æ­£å¸¸è§¦å‘

### 3. ç´¢å¼•éªŒè¯ âœ…

æ‰€æœ‰å¿…è¦ç´¢å¼•å·²åˆ›å»ºï¼ŒæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–åˆ°ä½ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export DATABASE_URL="postgresql://user:password@localhost:5432/pitchone"

# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
cd backend
bash scripts/init-db.sh
```

---

## ğŸ“ æµ‹è¯•æ–‡ä»¶

- `test_crud.sql`: CRUD æ“ä½œå…¨è¦†ç›–æµ‹è¯•
- `test_constraints.sql`: çº¦æŸå’Œå…³è”éªŒè¯æµ‹è¯•

---

**ç”Ÿæˆæ—¶é—´**: 2025-11-08
